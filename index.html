<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Auto-√©valuation ‚Äì Conna√Ætre mon territoire | LS4YOU x Mission Locale</title>

<style>
  /* ===========================
     LS4YOU x Mission Locale PB
     Palette (STRICTE)
  ============================ */
  :root{
    --orange:#f39200;
    --vert:#95c11f;
    --bleu:#2897d5;
    --rose:#d60b52;
    --violet:#a3195b;
    --rouge:#9f3d3f;
    --noir:#171718;
    --blanc:#ffffff;

    --bg: var(--blanc);
    --txt: var(--noir);

    --radius-xl: 28px;
    --radius-lg: 20px;
    --radius-md: 14px;

    --shadow: 0 10px 30px rgba(23, 23, 24, .10);
    --shadow-soft: 0 8px 20px rgba(23, 23, 24, .08);

    --maxw: 1040px;
  }

  /* ===========================
     Base
  ============================ */
  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    background: var(--bg);
    color: var(--txt);
    line-height: 1.35;
  }
  a{ color:inherit; }
  .wrap{
    width: min(var(--maxw), calc(100% - 32px));
    margin: 0 auto;
    padding: 18px 0 36px;
    position: relative;
  }

  /* ===========================
     D√©cor LS4YOU (puzzles, pastilles)
  ============================ */
  .float-dots{
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
  }
  .dot{
    position:absolute;
    border-radius: 999px;
    opacity: .18;
    filter: blur(.2px);
  }
  .dot.d1{ width:22px;height:22px; left: 6%; top: 14%; background: var(--vert); }
  .dot.d2{ width:14px;height:14px; left: 12%; top: 68%; background: var(--rose); }
  .dot.d3{ width:18px;height:18px; left: 88%; top: 22%; background: var(--orange); }
  .dot.d4{ width:10px;height:10px; left: 82%; top: 74%; background: var(--bleu); }
  .dot.d5{ width:26px;height:26px; left: 46%; top: 10%; background: var(--violet); opacity:.12; }
  .dot.d6{ width:16px;height:16px; left: 52%; top: 86%; background: var(--rouge); opacity:.14; }

  /* Puzzle ‚Äúchips‚Äù d√©coratifs */
  .puzzle{
    position:absolute;
    width: 94px;
    height: 64px;
    border-radius: 20px;
    box-shadow: var(--shadow-soft);
    opacity: .95;
  }
  .puzzle::before,
  .puzzle::after{
    content:"";
    position:absolute;
    width: 26px; height: 26px;
    border-radius: 999px;
    background: inherit;
    opacity: 1;
  }
  .puzzle::before{ left:-10px; top: 18px; }
  .puzzle::after{ right:-10px; top: 18px; }
  .pz1{ background: var(--bleu); left: -16px; top: 88px; transform: rotate(-8deg); }
  .pz2{ background: var(--orange); right: -14px; top: 140px; transform: rotate(10deg); }
  .pz3{ background: var(--vert); left: -10px; top: 520px; transform: rotate(6deg); opacity:.75; }
  .pz4{ background: var(--rose); right: -12px; top: 640px; transform: rotate(-6deg); opacity:.75; }

  /* ===========================
     En-t√™te / ‚ÄúPage de couverture‚Äù
  ============================ */
  header{
    position: relative;
    z-index: 1;
    margin-bottom: 18px;
  }
  .cover{
    background: var(--bg);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow);
    padding: 18px;
    overflow: hidden;
    border: 1px solid rgba(23,23,24,.08);
    position: relative;
  }

  .topbar{
    display:flex;
    gap: 14px;
    align-items:center;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  .brand{
    display:flex;
    align-items:center;
    gap: 12px;
    min-width: 260px;
  }
  .brand img{
    height: 46px;
    width: auto;
    display:block;
  }
  .badge{
    display:inline-flex;
    align-items:center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 999px;
    background: rgba(41,151,213,.12);
    border: 1px solid rgba(41,151,213,.28);
    font-weight: 700;
    font-size: 13px;
  }
  .badge .pill{
    width: 10px; height: 10px; border-radius: 999px; background: var(--bleu);
  }

  .hero{
    margin-top: 16px;
    display:grid;
    grid-template-columns: 1.2fr .8fr;
    gap: 18px;
    align-items: center;
  }
  @media (max-width: 820px){
    .hero{ grid-template-columns: 1fr; }
  }

  .title{
    margin:0;
    font-weight: 900;
    letter-spacing: .2px;
    font-size: clamp(26px, 3.2vw, 40px);
    line-height: 1.05;
    color: var(--rouge);
  }
  .subtitle{
    margin: 10px 0 0;
    font-size: 15px;
    color: rgba(23,23,24,.85);
    max-width: 56ch;
  }
  .notice{
    margin-top: 12px;
    display:flex;
    gap: 10px;
    align-items:flex-start;
    padding: 12px 14px;
    border-radius: var(--radius-lg);
    background: rgba(149,193,31,.12);
    border: 1px solid rgba(149,193,31,.28);
  }
  .notice .icon{
    width: 34px; height: 34px;
    border-radius: 14px;
    background: var(--vert);
    display:grid;
    place-items:center;
    color: var(--blanc);
    font-weight: 900;
    flex: 0 0 auto;
  }
  .notice p{ margin:0; font-size: 14px; }

  /* ‚ÄúPhoto ronde‚Äù (placeholder) */
  .portraitWrap{
    display:flex;
    justify-content: end;
  }
  .portrait{
    width: 210px; height: 210px;
    border-radius: 999px;
    background:
      radial-gradient(circle at 30% 25%, rgba(255,255,255,.55), rgba(255,255,255,0) 38%),
      linear-gradient(135deg, rgba(243,146,0,.95), rgba(40,151,213,.95));
    box-shadow: var(--shadow);
    position: relative;
    overflow:hidden;
    border: 10px solid rgba(255,255,255,.9);
  }
  .portrait::after{
    content:"";
    position:absolute;
    inset: -35px;
    background:
      radial-gradient(circle at 70% 30%, rgba(214,11,82,.25), rgba(214,11,82,0) 42%),
      radial-gradient(circle at 30% 75%, rgba(149,193,31,.22), rgba(149,193,31,0) 45%),
      radial-gradient(circle at 70% 75%, rgba(163,25,91,.20), rgba(163,25,91,0) 45%);
    transform: rotate(10deg);
  }
  .portraitLabel{
    margin-top: 10px;
    text-align:center;
    font-weight: 800;
    color: rgba(23,23,24,.85);
    font-size: 13px;
  }

  /* Frise inf√©rieure en capsules multi-couleurs */
  .capsules{
    margin-top: 16px;
    display:flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .cap{
    height: 10px;
    border-radius: 999px;
    flex: 1 1 80px;
    min-width: 56px;
    opacity: .95;
  }
  .cap.c1{ background: var(--orange); }
  .cap.c2{ background: var(--vert); }
  .cap.c3{ background: var(--bleu); }
  .cap.c4{ background: var(--rose); }
  .cap.c5{ background: var(--violet); }
  .cap.c6{ background: var(--rouge); }

  /* ===========================
     ‚ÄúPages‚Äù / blocs modulaires
  ============================ */
  main{
    position: relative;
    z-index: 1;
    margin-top: 14px;
    display: grid;
    grid-template-columns: 1fr;
    gap: 14px;
  }

  .page{
    background: var(--blanc);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow);
    border: 1px solid rgba(23,23,24,.08);
    overflow: hidden;
  }

  .pageHead{
    padding: 14px 16px;
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 12px;
    background:
      radial-gradient(circle at 20% 50%, rgba(243,146,0,.16), rgba(243,146,0,0) 44%),
      radial-gradient(circle at 70% 30%, rgba(40,151,213,.14), rgba(40,151,213,0) 44%),
      radial-gradient(circle at 85% 70%, rgba(149,193,31,.14), rgba(149,193,31,0) 44%);
  }
  .chapter{
    display:flex;
    align-items:center;
    gap: 10px;
  }
  .chapterNum{
    width: 42px; height: 42px;
    border-radius: 16px;
    display:grid;
    place-items:center;
    background: var(--rouge);
    color: var(--blanc);
    font-weight: 900;
    box-shadow: var(--shadow-soft);
    flex: 0 0 auto;
  }
  .chapterTitle{
    margin:0;
    font-weight: 900;
    font-size: 16px;
  }
  .chapterSub{
    margin: 2px 0 0;
    font-size: 13px;
    color: rgba(23,23,24,.72);
  }

  .tools{
    display:flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-end;
  }
  .btn{
    appearance:none;
    border: none;
    cursor:pointer;
    padding: 10px 12px;
    border-radius: 999px;
    font-weight: 800;
    font-size: 13px;
    display:inline-flex;
    align-items:center;
    gap: 8px;
    box-shadow: var(--shadow-soft);
  }
  .btn.primary{
    background: var(--bleu);
    color: var(--blanc);
  }
  .btn.ghost{
    background: rgba(23,23,24,.04);
    color: var(--noir);
    border: 1px solid rgba(23,23,24,.12);
    box-shadow: none;
  }
  .btn.warn{
    background: var(--orange);
    color: var(--noir);
  }

  .pageBody{
    padding: 16px;
  }

  /* ===========================
     Auto-√©valuation (cards / bulles)
  ============================ */
  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  @media (max-width: 900px){
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    border-radius: var(--radius-xl);
    border: 1px solid rgba(23,23,24,.10);
    padding: 14px;
    box-shadow: var(--shadow-soft);
    background: #fff;
  }
  .cardHead{
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 10px;
  }
  .tag{
    display:inline-flex;
    align-items:center;
    gap: 8px;
    padding: 8px 10px;
    border-radius: 999px;
    font-weight: 900;
    font-size: 12px;
    border: 1px solid rgba(23,23,24,.08);
  }
  .tag .mini{
    width: 10px; height: 10px;
    border-radius: 999px;
  }
  .t1{ background: rgba(159,61,63,.10); }
  .t1 .mini{ background: var(--rouge); }
  .t2{ background: rgba(243,146,0,.10); }
  .t2 .mini{ background: var(--orange); }
  .t3{ background: rgba(40,151,213,.10); }
  .t3 .mini{ background: var(--bleu); }
  .t4{ background: rgba(149,193,31,.12); }
  .t4 .mini{ background: var(--vert); }

  .subscore{
    font-weight: 900;
    font-size: 12px;
    color: rgba(23,23,24,.72);
  }

  .q{
    margin: 10px 0;
    padding: 10px 12px;
    border-radius: 18px;
    background: rgba(23,23,24,.03);
    border: 1px solid rgba(23,23,24,.08);
  }
  .q p{
    margin:0 0 10px;
    font-weight: 800;
    font-size: 14px;
  }

  .choices{
    display:flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .choice{
    flex: 1 1 120px;
    min-width: 120px;
    border-radius: 999px;
    padding: 10px 12px;
    border: 1px solid rgba(23,23,24,.10);
    background: #fff;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    gap: 8px;
    font-weight: 900;
    font-size: 13px;
    transition: transform .06s ease, box-shadow .12s ease, border-color .12s ease;
    user-select:none;
  }
  .choice:active{ transform: scale(.99); }
  .choice[data-v="0"] .dotv{ background: var(--rouge); }
  .choice[data-v="1"] .dotv{ background: var(--orange); }
  .choice[data-v="2"] .dotv{ background: var(--vert); }

  .dotv{
    width: 10px; height: 10px;
    border-radius: 999px;
  }
  .choice.selected{
    border-color: rgba(23,23,24,.2);
    box-shadow: var(--shadow-soft);
    background:
      radial-gradient(circle at 20% 50%, rgba(243,146,0,.12), rgba(243,146,0,0) 45%),
      radial-gradient(circle at 70% 30%, rgba(40,151,213,.10), rgba(40,151,213,0) 45%),
      #fff;
  }

  textarea{
    width: 100%;
    resize: vertical;
    min-height: 76px;
    border-radius: 18px;
    border: 1px solid rgba(23,23,24,.12);
    padding: 10px 12px;
    font-size: 14px;
    outline: none;
  }
  textarea:focus{
    border-color: rgba(40,151,213,.55);
    box-shadow: 0 0 0 4px rgba(40,151,213,.14);
  }
  .hint{
    margin: 10px 0 0;
    font-size: 12px;
    color: rgba(23,23,24,.70);
  }

  /* ===========================
     R√©sultat / barre de progression
  ============================ */
  .resultBox{
    margin-top: 12px;
    border-radius: var(--radius-xl);
    border: 1px solid rgba(23,23,24,.10);
    padding: 14px;
    background:
      radial-gradient(circle at 20% 50%, rgba(214,11,82,.10), rgba(214,11,82,0) 44%),
      radial-gradient(circle at 70% 30%, rgba(149,193,31,.10), rgba(149,193,31,0) 44%),
      #fff;
  }
  .resultTop{
    display:flex;
    gap: 12px;
    align-items:flex-start;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  .scoreBig{
    font-size: 20px;
    font-weight: 1000;
    color: var(--noir);
  }
  .message{
    margin: 6px 0 0;
    font-size: 14px;
    font-weight: 800;
    color: rgba(23,23,24,.85);
  }
  .progress{
    margin-top: 10px;
    height: 12px;
    border-radius: 999px;
    background: rgba(23,23,24,.08);
    overflow:hidden;
  }
  .bar{
    height:100%;
    width:0%;
    border-radius: 999px;
    background: linear-gradient(90deg, var(--rouge), var(--orange), var(--vert), var(--bleu));
    transition: width .25s ease;
  }

  .pillRow{
    margin-top: 10px;
    display:flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .pillSkill{
    border-radius: 999px;
    padding: 8px 10px;
    font-weight: 900;
    font-size: 12px;
    display:inline-flex;
    align-items:center;
    gap: 8px;
    border: 1px solid rgba(23,23,24,.08);
  }
  .pillSkill i{
    width:10px;height:10px;border-radius:999px; display:inline-block;
  }
  .ps1{ background: rgba(159,61,63,.10); } .ps1 i{ background: var(--rouge); }
  .ps2{ background: rgba(40,151,213,.10); } .ps2 i{ background: var(--bleu); }
  .ps3{ background: rgba(243,146,0,.10); } .ps3 i{ background: var(--orange); }
  .ps4{ background: rgba(149,193,31,.12); } .ps4 i{ background: var(--vert); }
  .ps5{ background: rgba(214,11,82,.10); } .ps5 i{ background: var(--rose); }
  .ps6{ background: rgba(163,25,91,.10); } .ps6 i{ background: var(--violet); }

  /* ===========================
     Footer mini
  ============================ */
  footer{
    margin-top: 14px;
    text-align:center;
    color: rgba(23,23,24,.65);
    font-size: 12px;
    position: relative;
    z-index: 1;
  }
</style>
</head>

<body>
  <!-- Pastilles flottantes -->
  <div class="float-dots" aria-hidden="true">
    <div class="dot d1"></div><div class="dot d2"></div><div class="dot d3"></div>
    <div class="dot d4"></div><div class="dot d5"></div><div class="dot d6"></div>
  </div>

  <div class="wrap">
    <!-- Puzzles d√©coratifs -->
    <div class="puzzle pz1" aria-hidden="true"></div>
    <div class="puzzle pz2" aria-hidden="true"></div>
    <div class="puzzle pz3" aria-hidden="true"></div>
    <div class="puzzle pz4" aria-hidden="true"></div>

    <!-- ‚ÄúPage de couverture‚Äù -->
    <header>
      <section class="cover">
        <div class="topbar">
          <div class="brand">
            <img
              src="https://www.lifeskills4youth.eu/wp-content/uploads/2024/07/LS4YOU_Logo.png"
              alt="Logo LS4YOU"
              loading="lazy"
              referrerpolicy="no-referrer"
            />
            <span class="badge" title="Style LS4YOU recolor√© Missions Locales">
              <span class="pill"></span>
              LS4YOU √ó Mission Locale
            </span>
          </div>

          <div class="tools">
            <button class="btn ghost" type="button" id="btnScroll">
              ‚¨áÔ∏è Aller √† l‚Äôauto-√©valuation
            </button>
          </div>
        </div>

        <div class="hero">
          <div>
            <h1 class="title">Conna√Ætre mon territoire</h1>
            <p class="subtitle">
              Auto-√©valuation rapide (0‚Äì1‚Äì2) pour te situer. <strong>Ce n‚Äôest pas un test</strong> :
              c‚Äôest une mani√®re de mettre en lumi√®re ce que tu sais d√©j√† faire.
            </p>

            <div class="notice">
              <div class="icon">i</div>
              <p>
                Choisis une r√©ponse par question :
                <strong>0 = Non</strong>, <strong>1 = Parfois</strong>, <strong>2 = Souvent</strong>.
                √Ä la fin, tu obtiens un score et une lecture simple.
              </p>
            </div>

            <div class="capsules" aria-hidden="true">
              <div class="cap c1"></div><div class="cap c2"></div><div class="cap c3"></div>
              <div class="cap c4"></div><div class="cap c5"></div><div class="cap c6"></div>
            </div>
          </div>

          <div class="portraitWrap">
            <div>
              <!-- Placeholder ‚Äúphoto ronde‚Äù : tu peux remplacer par une vraie photo si tu veux -->
              <div class="portrait" role="img" aria-label="Portrait jeune (placeholder)"></div>
              <div class="portraitLabel">Ambiance jeune ‚Ä¢ positive ‚Ä¢ inclusive</div>
            </div>
          </div>
        </div>
      </section>
    </header>

    <main>
      <!-- ‚ÄúPage de chapitre‚Äù -->
      <section class="page" id="eval">
        <div class="pageHead">
          <div class="chapter">
            <div class="chapterNum">01</div>
            <div>
              <p class="chapterTitle">Auto-√©valuation Life Skills</p>
              <p class="chapterSub">Identifier ‚Ä¢ Mesurer ‚Ä¢ Mettre en ≈ìuvre (√† ton rythme)</p>
            </div>
          </div>
          <div class="tools">
            <button class="btn warn" type="button" id="btnCalc">Voir mon r√©sultat</button>
            <button class="btn ghost" type="button" id="btnReset">R√©initialiser</button>
          </div>
        </div>

        <div class="pageBody">
          <div class="grid" id="cards"></div>

          <div class="resultBox" id="resultBox" aria-live="polite">
            <div class="resultTop">
              <div>
                <div class="scoreBig" id="scoreBig">Score : ‚Äî / 32</div>
                <div class="message" id="message">R√©ponds aux questions puis clique sur ‚ÄúVoir mon r√©sultat‚Äù.</div>
              </div>
              <div class="pillRow" aria-label="Life Skills mobilis√©es">
                <span class="pillSkill ps1"><i></i>Conscience de soi</span>
                <span class="pillSkill ps2"><i></i>Communication</span>
                <span class="pillSkill ps3"><i></i>Prise de d√©cision</span>
                <span class="pillSkill ps4"><i></i>Autonomie</span>
                <span class="pillSkill ps5"><i></i>Coop√©ration</span>
                <span class="pillSkill ps6"><i></i>Bien-√™tre</span>
              </div>
            </div>

            <div class="progress" aria-hidden="true">
              <div class="bar" id="bar"></div>
            </div>

            <p class="hint" id="hint">
              Astuce : si tu veux, note un exemple v√©cu dans chaque bloc (facultatif).
            </p>
          </div>
        </div>
      </section>

      <!-- Mini ‚Äúpage outils & ressources‚Äù (simple, optionnelle) -->
      <section class="page">
        <div class="pageHead">
          <div class="chapter">
            <div class="chapterNum" style="background: var(--bleu);">02</div>
            <div>
              <p class="chapterTitle">Outils & ressources</p>
              <p class="chapterSub">Ce score sert √† ouvrir une discussion (atelier / entretien / autonomie)</p>
            </div>
          </div>
        </div>
        <div class="pageBody">
          <div class="card" style="border-radius: var(--radius-xl);">
            <p style="margin:0; font-weight:900;">
              Ce que tu peux faire apr√®s
            </p>
            <ul style="margin:10px 0 0; padding-left: 18px;">
              <li>Rep√©rer une ressource locale que tu n‚Äôavais jamais utilis√©e.</li>
              <li>Identifier si tu te reconnais plut√¥t dans : <strong>rester / partir / revenir</strong>.</li>
              <li>Choisir une mini-action r√©aliste (m√™me tr√®s petite).</li>
            </ul>
            <p class="hint" style="margin-top:10px;">
              Rien n‚Äôest obligatoire : l‚Äôobjectif est de te redonner des options, pas de te mettre la pression.
            </p>
          </div>
        </div>
      </section>
    </main>

    <footer>
      LS4YOU x Mission Locale ‚Ä¢ Style ‚Äúbulles / puzzle‚Äù recolor√© palette Mission Locale Pays Basque ‚Ä¢ Aucune donn√©e enregistr√©e
    </footer>
  </div>

<script>
/* ===========================
   Auto-√©valuation (structure)
   - 4 blocs / 16 items = /32
   - Format 0 / 1 / 2
=========================== */

const MODEL = [
  {
    id: "b1",
    tagClass: "t1",
    tagLabel: "Mettre des mots",
    sub: "Conscience de soi ‚Ä¢ Communication",
    items: [
      "J‚Äôexplique mon territoire avec mes mots (quartier, ville, village).",
      "Je dis ce que j‚Äôaime / ce que je n‚Äôaime pas ici, sans me juger.",
      "Je d√©cris comment je vis mon territoire au quotidien (rythme, habitudes).",
      "Je rep√®re des lieux o√π je me sens bien / moins bien."
    ]
  },
  {
    id: "b2",
    tagClass: "t2",
    tagLabel: "Ressources utiles",
    sub: "Autonomie ‚Ä¢ Communication",
    items: [
      "Je connais au moins 1 lieu / structure qui peut aider les jeunes.",
      "Je rep√®re une personne ou un endroit ressource sur le territoire.",
      "Je sais o√π chercher de l‚Äôaide si j‚Äôen ai besoin.",
      "Je d√©couvre des ressources locales que je ne connaissais pas."
    ]
  },
  {
    id: "b3",
    tagClass: "t3",
    tagLabel: "Comprendre les choix",
    sub: "Prise de d√©cision ‚Ä¢ Coop√©ration",
    items: [
      "Je comprends pourquoi certains jeunes restent sur le territoire.",
      "Je comprends pourquoi certains jeunes partent ailleurs.",
      "J‚Äô√©change avec d‚Äôautres sur leurs choix (rester, partir, revenir).",
      "Je vois que ‚Äúpartir‚Äù peut √™tre une strat√©gie, pas un √©chec."
    ]
  },
  {
    id: "b4",
    tagClass: "t4",
    tagLabel: "Se projeter",
    sub: "Autonomie ‚Ä¢ Bien-√™tre",
    items: [
      "J‚Äôimagine une situation possible pour moi (m√™me simple).",
      "Je vois une mini-action r√©alisable √† mon √©chelle, sans pression.",
      "Je me reconnais plut√¥t dans une situation (rester / partir / revenir).",
      "Je me donne le droit d‚Äôavancer √† mon rythme."
    ]
  }
];

const state = {}; // { key: 0|1|2 }
let totalMax = 0;

function build(){
  const cards = document.getElementById("cards");
  cards.innerHTML = "";
  totalMax = 0;

  MODEL.forEach((block, bi) => {
    totalMax += block.items.length * 2;

    const card = document.createElement("div");
    card.className = "card";
    card.id = block.id;

    card.innerHTML = `
      <div class="cardHead">
        <span class="tag ${block.tagClass}">
          <span class="mini"></span>
          ${block.tagLabel}
        </span>
        <span class="subscore" id="${block.id}-sub">Sous-score : ‚Äî / ${block.items.length*2}</span>
      </div>
      <div class="hint" style="margin:-4px 0 10px;">${block.sub}</div>
      <div id="${block.id}-qs"></div>
      <div style="margin-top:10px;">
        <textarea id="${block.id}-ex" placeholder="Exemple v√©cu (facultatif) : une situation, un lieu, une ressource..."></textarea>
      </div>
    `;

    cards.appendChild(card);

    const qWrap = card.querySelector(`#${block.id}-qs`);
    block.items.forEach((text, qi) => {
      const key = `${block.id}-${qi}`;
      const q = document.createElement("div");
      q.className = "q";
      q.innerHTML = `
        <p>${text}</p>
        <div class="choices" role="radiogroup" aria-label="R√©ponses">
          <div class="choice" data-key="${key}" data-v="0" role="radio" tabindex="0" aria-checked="false">
            <span class="dotv"></span> Non
          </div>
          <div class="choice" data-key="${key}" data-v="1" role="radio" tabindex="0" aria-checked="false">
            <span class="dotv"></span> Parfois
          </div>
          <div class="choice" data-key="${key}" data-v="2" role="radio" tabindex="0" aria-checked="false">
            <span class="dotv"></span> Souvent
          </div>
        </div>
      `;
      qWrap.appendChild(q);
    });
  });

  // events (click + clavier)
  document.querySelectorAll(".choice").forEach(el => {
    el.addEventListener("click", () => selectChoice(el.dataset.key, parseInt(el.dataset.v,10)));
    el.addEventListener("keydown", (e) => {
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        selectChoice(el.dataset.key, parseInt(el.dataset.v,10));
      }
    });
  });

  updateSubscores();
}

function selectChoice(key, v){
  state[key] = v;

  // visuel : d√©s√©lectionner les 3 options du m√™me key
  document.querySelectorAll(`.choice[data-key="${key}"]`).forEach(btn => {
    btn.classList.remove("selected");
    btn.setAttribute("aria-checked","false");
  });

  // s√©lectionner l‚Äôoption cliqu√©e
  const chosen = document.querySelector(`.choice[data-key="${key}"][data-v="${v}"]`);
  if(chosen){
    chosen.classList.add("selected");
    chosen.setAttribute("aria-checked","true");
  }

  updateSubscores();
}

function updateSubscores(){
  MODEL.forEach(block => {
    let sub = 0;
    block.items.forEach((_, qi) => {
      const key = `${block.id}-${qi}`;
      if(Number.isInteger(state[key])) sub += state[key];
    });
    const el = document.getElementById(`${block.id}-sub`);
    if(el) el.textContent = `Sous-score : ${sub} / ${block.items.length*2}`;
  });
}

function calc(){
  // score total
  let score = 0;
  let answered = 0;
  MODEL.forEach(block => {
    block.items.forEach((_, qi) => {
      const key = `${block.id}-${qi}`;
      if(Number.isInteger(state[key])){
        score += state[key];
        answered++;
      }
    });
  });

  // message (seuils sur /32)
  let message;
  if(answered === 0){
    message = "Commence par r√©pondre √† quelques questions üôÇ";
  } else if(score <= 12){
    message = "Tu d√©butes dans la lecture de ton territoire. C‚Äôest normal : c‚Äôest un point de d√©part.";
  } else if(score <= 23){
    message = "Tu d√©veloppes cette comp√©tence. Tu as d√©j√† des rep√®res et tu peux les renforcer.";
  } else {
    message = "Tu as une bonne lecture de ton territoire : tu rep√®res des ressources et des options possibles.";
  }

  // affichage
  const scoreBig = document.getElementById("scoreBig");
  const msg = document.getElementById("message");
  const bar = document.getElementById("bar");

  scoreBig.textContent = `Score : ${score} / ${totalMax}`;
  msg.textContent = message;

  const pct = Math.round((score / totalMax) * 100);
  bar.style.width = `${isFinite(pct) ? pct : 0}%`;
}

function resetAll(){
  // reset state
  for(const k in state) delete state[k];

  // reset UI
  document.querySelectorAll(".choice").forEach(btn => {
    btn.classList.remove("selected");
    btn.setAttribute("aria-checked","false");
  });
  document.querySelectorAll("textarea").forEach(t => t.value = "");

  updateSubscores();

  document.getElementById("scoreBig").textContent = "Score : ‚Äî / 32";
  document.getElementById("message").textContent = "R√©ponds aux questions puis clique sur ‚ÄúVoir mon r√©sultat‚Äù.";
  document.getElementById("bar").style.width = "0%";
}

document.getElementById("btnCalc").addEventListener("click", calc);
document.getElementById("btnReset").addEventListener("click", resetAll);
document.getElementById("btnScroll").addEventListener("click", () => {
  document.getElementById("eval").scrollIntoView({behavior:"smooth", block:"start"});
});

build();
</script>
</body>
</html>
